@YakubPlayground âžœ /workspaces/Thanos-remotewrite/Symbols (master) $ ./forwarding.sh 
Fetching services in namespace: monitoring
Services fetched: alertmanager 9093 
prometheus-alertmanager 8080 80 32002 31950
prometheus-server 8081 80 31017 31115
thanos-frontend-query 8082 9090 
thanos-frontend-query-frontend 8083 9090 
thanos-frontend-query-grpc 8084 10901 
thanos-query 9090 8085 8086 
thanos-query-frontend 8087 9090 
thanos-query-grpc 8088 10901 
thanos-query-query 8089 9090 
thanos-query-query-frontend 8090 9090 
thanos-query-query-grpc 8091 10901 
thanos-receiver 8092 
thanos-receiver-query 8093 9090 
thanos-receiver-query-frontend 8094 9090 
thanos-receiver-query-grpc 8095 10901 
thanos-remote-write 8096 
thanos-remote-write-query 8097 9090 
thanos-remote-write-query-frontend 8098 9090 
thanos-remote-write-query-grpc 8099 10901 
thanos-storage-gateway 8100 
thanos-storage-gateway-query 8101 9090 
thanos-storage-gateway-query-frontend 8102 9090 
thanos-storage-gateway-query-grpc 8103 10901 
Waiting for all port-forwarding processes to complete
Processing service: 9093
Target port: 
Node port: 
No node port found for service 9093, skipping port forwarding
Processing service: thanos-storage-gateway-query-frontend
Target port: 
Node port: 
No node port found for service thanos-storage-gateway-query-frontend, skipping port forwarding
Processing service: thanos-storage-gateway-query-grpc
Target port: 
Node port: 
No node port found for service thanos-storage-gateway-query-grpc, skipping port forwarding
Processing service: 8094
Target port: 
Node port: 
No node port found for service 8094, skipping port forwarding
Processing service: 31017
Target port: 
Node port: 
No node port found for service 31017, skipping port forwarding
Processing service: thanos-frontend-query-frontend
Target port: 
Node port: 
No node port found for service thanos-frontend-query-frontend, skipping port forwarding
Processing service: thanos-query
Target port: 
Node port: 
No node port found for service thanos-query, skipping port forwarding
Processing service: 8100
Target port: 
Node port: 
No node port found for service 8100, skipping port forwarding
Processing service: 8088
Target port: 
Node port: 
No node port found for service 8088, skipping port forwarding
Processing service: 8083
Target port: 
Node port: 
No node port found for service 8083, skipping port forwarding
Processing service: alertmanager
Target port: 
Node port: 
No node port found for service alertmanager, skipping port forwarding
Processing service: 80
Target port: 
Node port: 
No node port found for service 80, skipping port forwarding
Processing service: 31115
Target port: 
Node port: 
No node port found for service 31115, skipping port forwarding
Processing service: 8081
Target port: 
Node port: 
No node port found for service 8081, skipping port forwarding
Processing service: thanos-frontend-query-grpc
Target port: 
Node port: 
No node port found for service thanos-frontend-query-grpc, skipping port forwarding
Processing service: thanos-receiver-query-grpc
Target port: 
Node port: 
No node port found for service thanos-receiver-query-grpc, skipping port forwarding
Processing service: prometheus-alertmanager
Target port: 
Node port: 
No node port found for service prometheus-alertmanager, skipping port forwarding
Processing service: 8098
Target port: 
Node port: 
No node port found for service 8098, skipping port forwarding
Processing service: thanos-frontend-query
Target port: 
Node port: 
No node port found for service thanos-frontend-query, skipping port forwarding
Processing service: 8092
Target port: 
Node port: 
No node port found for service 8092, skipping port forwarding
Processing service: 10901
Target port: 
Node port: 
No node port found for service 10901, skipping port forwarding
Processing service: thanos-remote-write
Target port: 
Node port: 
No node port found for service thanos-remote-write, skipping port forwarding
Processing service: 8085
Target port: 
Node port: 
No node port found for service 8085, skipping port forwarding
Processing service: 9090
Target port: 
Node port: 
No node port found for service 9090, skipping port forwarding
Processing service: 10901
Target port: 
Node port: 
No node port found for service 10901, skipping port forwarding
Processing service: 9090
Target port: 
Node port: 
No node port found for service 9090, skipping port forwarding
Processing service: 32002
Target port: 
Node port: 
No node port found for service 32002, skipping port forwarding
Processing service: thanos-receiver
Target port: 
Node port: 
No node port found for service thanos-receiver, skipping port forwarding
Processing service: 8091
Target port: 
Node port: 
No node port found for service 8091, skipping port forwarding
Processing service: prometheus-server
Target port: 
Node port: 
No node port found for service prometheus-server, skipping port forwarding
Processing service: thanos-query-query
Target port: 
Node port: 
No node port found for service thanos-query-query, skipping port forwarding
Processing service: 8087
Target port: 
Node port: 
No node port found for service 8087, skipping port forwarding
Processing service: thanos-query-grpc
Target port: 
Node port: 
Processing service: 9090
Target port: 
Node port: 
No node port found for service thanos-query-grpc, skipping port forwarding
No node port found for service 9090, skipping port forwarding
Processing service: 8093
Target port: 
Node port: 
No node port found for service 8093, skipping port forwarding
Processing service: 8090
Target port: 
Node port: 
No node port found for service 8090, skipping port forwarding
Processing service: thanos-remote-write-query-grpc
Target port: 
Node port: 
No node port found for service thanos-remote-write-query-grpc, skipping port forwarding
Processing service: 8096
Target port: 
Node port: 
No node port found for service 8096, skipping port forwarding
Processing service: 8084
Processing service: 80
Target port: 
Target port: 
Node port: 
Node port: 
No node port found for service 8084, skipping port forwarding
No node port found for service 80, skipping port forwarding
Processing service: thanos-query-frontend
Target port: 
Node port: 
No node port found for service thanos-query-frontend, skipping port forwarding
Processing service: 10901
Target port: 
Node port: 
No node port found for service 10901, skipping port forwarding
Processing service: 9090
Target port: 
Node port: 
No node port found for service 9090, skipping port forwarding
Processing service: 31950
Target port: 
Node port: 
No node port found for service 31950, skipping port forwarding
Processing service: 8082
Target port: 
Node port: 
No node port found for service 8082, skipping port forwarding
Processing service: 8097
Target port: 
Node port: 
No node port found for service 8097, skipping port forwarding
Processing service: 8095
Processing service: 8103
Target port: 
Node port: 
No node port found for service 8103, skipping port forwarding
Target port: 
Node port: 
No node port found for service 8095, skipping port forwarding
Processing service: thanos-query-query-grpc
Target port: 
Node port: 
No node port found for service thanos-query-query-grpc, skipping port forwarding
Processing service: 9090
Target port: 
Node port: 
No node port found for service 9090, skipping port forwarding
Processing service: thanos-receiver-query
Target port: 
Node port: 
Processing service: 9090
Target port: 
Node port: 
No node port found for service 9090, skipping port forwarding
No node port found for service thanos-receiver-query, skipping port forwarding
Processing service: thanos-query-query-frontend
Target port: 
Node port: 
No node port found for service thanos-query-query-frontend, skipping port forwarding
Processing service: thanos-receiver-query-frontend
Target port: 
Node port: 
No node port found for service thanos-receiver-query-frontend, skipping port forwarding
Processing service: 9090
Target port: 
Node port: 
No node port found for service 9090, skipping port forwarding
Processing service: 10901
Target port: 
Node port: 
No node port found for service 10901, skipping port forwarding
Processing service: 10901
Target port: 
Node port: 
No node port found for service 10901, skipping port forwarding
Processing service: 9090
Target port: 
Node port: 
No node port found for service 9090, skipping port forwarding
Processing service: thanos-storage-gateway
Target port: 
Node port: 
No node port found for service thanos-storage-gateway, skipping port forwarding
Processing service: 9090
Target port: 
Node port: 
No node port found for service 9090, skipping port forwarding
Processing service: 8101
Target port: 
Node port: 
No node port found for service 8101, skipping port forwarding
Processing service: 8086
Target port: 
Node port: 
No node port found for service 8086, skipping port forwarding
Processing service: 9090
Target port: 
Node port: 
No node port found for service 9090, skipping port forwarding
Processing service: thanos-remote-write-query
Target port: 
Node port: 
No node port found for service thanos-remote-write-query, skipping port forwarding
Processing service: 8089
Target port: 
Node port: 
No node port found for service 8089, skipping port forwarding
Processing service: 8080
Target port: 
Node port: 
No node port found for service 8080, skipping port forwarding
Processing service: thanos-storage-gateway-query
Target port: 
Node port: 
No node port found for service thanos-storage-gateway-query, skipping port forwarding
Processing service: 10901
Target port: 
Node port: 
No node port found for service 10901, skipping port forwarding
Processing service: 9090
Target port: 
Node port: 
No node port found for service 9090, skipping port forwarding
Processing service: 8099
Target port: 
Node port: 
No node port found for service 8099, skipping port forwarding
Processing service: thanos-remote-write-query-frontend
Target port: 
Node port: 
No node port found for service thanos-remote-write-query-frontend, skipping port forwarding
Processing service: 9090
Target port: 
Node port: 
No node port found for service 9090, skipping port forwarding
Processing service: 8102
Target port: 
Node port: 
No node port found for service 8102, skipping port forwarding
All port-forwarding processes completed


The issue seems to be that the script is not correctly parsing the services and their ports. To fix this, you can modify the `forwarding.sh` script to correctly handle services with multiple ports and ensure that the correct ports are being forwarded. Here is an updated version of the script:

```shell
#!/bin/bash
NAMESPACE="monitoring"

echo "Fetching services in namespace: $NAMESPACE"
SERVICES=$(kubectl get svc -n $NAMESPACE -o jsonpath='{range .items[*]}{.metadata.name}{" "}{range .spec.ports[*]}{.port}{" "}{.nodePort}{" "}{end}{"\n"}{end}')
echo "Services fetched: $SERVICES"

for SERVICE in $SERVICES; do
    (
        SERVICE_NAME=$(echo $SERVICE | awk '{print $1}')
        PORTS=$(echo $SERVICE | awk '{$1=""; print $0}')
        
        echo "Processing service: $SERVICE_NAME"
        
        while read -r TARGET_PORT NODE_PORT; do
            echo "Target port: $TARGET_PORT"
            echo "Node port: $NODE_PORT"
            
            if [ -n "$NODE_PORT" ]; then
                echo "Port forwarding $SERVICE_NAME from $NODE_PORT to $TARGET_PORT"
                kubectl port-forward svc/$SERVICE_NAME $NODE_PORT:$TARGET_PORT -n $NAMESPACE &
            else
                echo "No node port found for target port $TARGET_PORT of service $SERVICE_NAME, skipping port forwarding"
            fi
        done <<< "$PORTS"
    ) &
done

echo "Waiting for all port-forwarding processes to complete"
wait
echo "All port-forwarding processes completed"
```

This script correctly handles services with multiple ports and ensures that each port is processed and forwarded correctly.